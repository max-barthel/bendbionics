---
description: Backend FastAPI API endpoint patterns, response formats, and error handling
globs: ["backend/app/api/**/*.py", "backend/app/routes/**/*.py"]
alwaysApply: false
---

# Backend FastAPI Development Standards

## API Development Pattern

When creating FastAPI endpoints:

```python
from fastapi import APIRouter, Depends
from sqlmodel import Session
from app.models.pcc.types import PCCParams
from app.api.responses import success_response, created_response, error_response
from app.auth import get_current_user
from app.database import get_session
from app.models.user import User

router = APIRouter(prefix="/api", tags=["feature"])

@router.post("/endpoint")
async def endpoint_name(
    params: PCCParams,
    current_user: User = Depends(get_current_user),
    session: Session = Depends(get_session),
):
    """
    Endpoint description with clear docstring.

    Args:
        params: Input parameters
        current_user: Authenticated user (from dependency)
        session: Database session (from dependency)

    Returns:
        JSONResponse with standardized format
    """
    # Business logic here
    result = process_data(params, session)

    # Use helper functions for consistent responses
    return success_response(
        data=result,
        message="Operation completed successfully"
    )

@router.post("/create")
async def create_endpoint(
    data: CreateModel,
    current_user: User = Depends(get_current_user),
    session: Session = Depends(get_session),
):
    """Create endpoint returns 201 status."""
    result = create_data(data, session, current_user.id)
    return created_response(
        data=result,
        message="Resource created successfully"
    )
```

## Response Format Standards

All API responses must use the unified response helpers from `app.api.responses`:

- `success_response()`: Standard 200 response with data
- `created_response()`: 201 response for resource creation
- `error_response()`: Standardized error responses
- `paginated_response()`: Paginated list responses

Response format includes:
- `success`: Boolean indicating operation success
- `data`: Response payload (automatically serialized)
- `message`: Human-readable message
- `timestamp`: ISO timestamp (auto-generated)
- `request_id`: Unique request identifier (auto-extracted from request)

## Error Handling

- **Use Helper Functions**: Use `error_response()` for consistent error format
- **HTTP Exceptions**: Use `HTTPException` for FastAPI's built-in error handling
- **User-Friendly Messages**: Clear error messages for users
- **Fail Fast**: Let errors bubble up, don't over-catch
- **Request Context**: Errors automatically include request_id when available

See `backend-patterns.mdc` for database, authentication, and service layer patterns.
