name: Auto-assign Issues to Project

on:
  issues:
    types: [opened]

jobs:
  assign-to-project:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      projects: write
    steps:
      - name: Add issue to project
        run: |
          # Your project ID from https://github.com/users/max-barthel/projects/2
          PROJECT_ID="PVT_kwDOOYVt384A0XT2"
          
          # Add issue to project using GitHub API
          curl -X POST \
            -H "Authorization: token ${{ github.token }}" \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Content-Type: application/json" \
            -d '{
              "query": "mutation($projectId: ID!, $contentId: ID!) { addProjectV2ItemById(input: {projectId: $projectId, contentId: $contentId}) { item { id } } }",
              "variables": {
                "projectId": "'$PROJECT_ID'",
                "contentId": "${{ github.event.issue.node_id }}"
              }
            }' \
            https://api.github.com/graphql
          
          echo "✅ Issue #${{ github.event.issue.number }} added to project"

      - name: Auto-assign labels
        run: |
          ISSUE_TITLE="${{ github.event.issue.title }}"
          ISSUE_NUMBER="${{ github.event.issue.number }}"
          
          # Determine labels based on title patterns
          if [[ "$ISSUE_TITLE" =~ ^\[BUG\] ]]; then
            LABELS='["bug", "status: needs-triage"]'
            echo "✅ Auto-assigning bug labels"
          elif [[ "$ISSUE_TITLE" =~ ^\[FEATURE\] ]]; then
            LABELS='["enhancement", "status: needs-triage"]'
            echo "✅ Auto-assigning enhancement labels"
          elif [[ "$ISSUE_TITLE" =~ ^\[DOCS\] ]]; then
            LABELS='["documentation", "status: needs-triage"]'
            echo "✅ Auto-assigning documentation labels"
          elif [[ "$ISSUE_TITLE" =~ ^\[QUESTION\] ]]; then
            LABELS='["question", "status: needs-triage"]'
            echo "✅ Auto-assigning question labels"
          else
            LABELS='["status: needs-triage"]'
            echo "✅ Auto-assigning needs-triage label"
          fi
          
          # Add labels using GitHub API
          curl -X POST \
            -H "Authorization: token ${{ github.token }}" \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Content-Type: application/json" \
            -d '{"labels": '$LABELS'}' \
            https://api.github.com/repos/${{ github.repository }}/issues/$ISSUE_NUMBER/labels
          
          echo "✅ Labels added to issue #$ISSUE_NUMBER"