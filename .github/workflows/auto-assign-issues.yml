name: Auto-assign Issues to Project

on:
  issues:
    types: [opened]

jobs:
  assign-to-project:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      projects: write
    steps:
      - name: Add issue to project
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          # Your project ID from https://github.com/users/max-barthel/projects/2
          PROJECT_ID="PVT_kwDOOYVt384A0XT2"
          
          # Add issue to project
          gh api graphql -f query='
            mutation($projectId: ID!, $contentId: ID!) {
              addProjectV2ItemById(input: {projectId: $projectId, contentId: $contentId}) {
                item {
                  id
                }
              }
            }
          ' -f projectId="$PROJECT_ID" -f contentId="${{ github.event.issue.node_id }}"
          
          echo "✅ Issue #${{ github.event.issue.number }} added to project"

      - name: Auto-assign labels
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          ISSUE_TITLE="${{ github.event.issue.title }}"
          
          # Auto-assign labels based on title patterns
          if [[ "$ISSUE_TITLE" =~ ^\[BUG\] ]]; then
            gh issue edit ${{ github.event.issue.number }} --add-label "bug,status: needs-triage"
            echo "✅ Auto-assigned bug labels"
          elif [[ "$ISSUE_TITLE" =~ ^\[FEATURE\] ]]; then
            gh issue edit ${{ github.event.issue.number }} --add-label "enhancement,status: needs-triage"
            echo "✅ Auto-assigned enhancement labels"
          elif [[ "$ISSUE_TITLE" =~ ^\[DOCS\] ]]; then
            gh issue edit ${{ github.event.issue.number }} --add-label "documentation,status: needs-triage"
            echo "✅ Auto-assigned documentation labels"
          elif [[ "$ISSUE_TITLE" =~ ^\[QUESTION\] ]]; then
            gh issue edit ${{ github.event.issue.number }} --add-label "question,status: needs-triage"
            echo "✅ Auto-assigned question labels"
          else
            gh issue edit ${{ github.event.issue.number }} --add-label "status: needs-triage"
            echo "✅ Auto-assigned needs-triage label"
          fi