echo "ğŸ” Pre-commit checks..."

# Check if we're in the right directory
if [ ! -f "package.json" ] || [ ! -d "frontend" ] || [ ! -d "backend" ]; then
  echo "âŒ Please run this script from the project root directory"
  exit 1
fi

# Run light cleanup before commit (preserves node_modules)
echo "ğŸ§¹ Running light cleanup..."
./scripts/cleanup.sh --light --force > /dev/null 2>&1 || true
echo "âœ… Cleanup completed"

# Only check for critical issues
echo "âš¡ Checking for critical errors only..."

# Frontend - only check for actual errors, not warnings
echo "ğŸ“ Checking frontend for critical errors..."
cd frontend
# Only check for actual errors, allow warnings
if ! npx eslint src/ --quiet 2>/dev/null; then
  # Check if it's just warnings or actual errors
  if npx eslint src/ --quiet 2>/dev/null | grep -q "error"; then
    echo "âŒ Critical frontend errors found. Please fix before committing."
    exit 1
  fi
fi
cd ..

# Backend - only check for critical errors
echo "ğŸ Checking backend for critical errors..."
cd backend
# Only check for syntax errors and critical issues
uv run python -m py_compile app/main.py 2>/dev/null || {
  echo "âŒ Critical Python syntax errors found."
  exit 1
}
# Check for critical linting issues only
uv run ruff check . --select=E9,F63,F7,F82 --quiet 2>/dev/null || {
  echo "âŒ Critical backend errors found."
  exit 1
}
cd ..

echo "âœ… No critical errors found - commit allowed!"
