#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Quick pre-push checks..."

# Check if we're in the right directory
if [ ! -f "package.json" ] || [ ! -d "frontend" ] || [ ! -d "backend" ]; then
  echo "âŒ Please run this script from the project root directory"
  exit 1
fi

# Quick tests - only core user flows
echo "ğŸ§ª Running core tests..."

# Frontend - only critical tests
echo "ğŸ“ Running frontend core tests..."
cd frontend
npm run test -- --run --reporter=basic
if [ $? -ne 0 ]; then
  echo "âŒ Frontend core tests failed."
  exit 1
fi
cd ..

# Backend - only critical APIs
echo "ğŸ Running backend core tests..."
cd backend
python -m pytest tests/test_core_apis.py -v
if [ $? -ne 0 ]; then
  echo "âŒ Backend core tests failed."
  exit 1
fi
cd ..

# Critical linting only - startup philosophy
echo "ğŸ” Checking for critical issues only..."
cd frontend
# Only fail on actual errors, not warnings
npm run lint -- --quiet --max-warnings 1000 2>/dev/null | grep -E "(error|Error)" >/dev/null
if [ $? -eq 0 ]; then
  echo "âŒ Critical frontend errors found."
  exit 1
else
  echo "âœ… No critical frontend errors found."
fi
cd ..

echo "âœ… Quick checks passed!"
echo "ğŸ‰ Ready to push!"
